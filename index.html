<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WildfireWatch - Live Fire Data</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />

  <!-- Map Styling -->
  <style>
    #map {
      height: 100vh;
      width: 100%;
    }
  </style>
</head>
<body>

  <!-- Map container -->
  <div id="map"></div>

  <!-- Year range filter sliders -->
  <div style="position: absolute; top: 10px; left: 10px; z-index: 1000; background: white; padding: 10px; border-radius: 5px;">
    <label for="minYearSlider"><strong>Filter by Year Range:</strong></label>
    <br>
    <label for="minYearSlider">From:</label>
    <input type="range" id="minYearSlider" min="2000" max="2025" value="2000" step="1" />
    <span id="minYearValue">2000</span>
    <br>
    <label for="maxYearSlider">To:</label>
    <input type="range" id="maxYearSlider" min="2000" max="2025" value="2025" step="1" />
    <span id="maxYearValue">2025</span>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

  <!-- Esri-Leaflet JS (allows FeatureServer connections) -->
  <script src="https://unpkg.com/esri-leaflet@3.0.4/dist/esri-leaflet.js"></script>

  <script>
  // Initialize the map
  var map = L.map('map').setView([37.7749, -122.4194], 6);  // Default center, zoomed out on the US

  // Add OpenStreetMap base tiles
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  // Connect to the new Fire Perimeter FeatureServer
  var fireLayer = L.esri.featureLayer({
    url: "https://services.arcgis.com/LBbVDC0hKPAnLRpO/arcgis/rest/services/Fire_Perimeter_History_Since_2000__over_100_acre/FeatureServer",
    style: function (feature) {
      return {
        color: "red",
        weight: 1,
        fillColor: "orange",
        fillOpacity: 0.3
      };
    },
    onEachFeature: function (feature, layer) {
      if (feature.properties) {
        layer.bindPopup(
          "<strong>Fire Year:</strong> " + feature.properties.FIRE_YEAR +
          "<br><strong>Agency:</strong> " + feature.properties.AGENCY +
          "<br><strong>Acres:</strong> " + feature.properties.GIS_ACRES.toFixed(2)
        );
      }
    },
    // Filter fires by year range
    filter: function (feature) {
      var fireYear = feature.properties.FIRE_YEAR;
      return fireYear >= 2000 && fireYear <= 2025; // Default range
    }
  }).addTo(map);

  // Update the map when the sliders' values change
  var minYearSlider = document.getElementById('minYearSlider');
  var maxYearSlider = document.getElementById('maxYearSlider');
  var minYearValue = document.getElementById('minYearValue');
  var maxYearValue = document.getElementById('maxYearValue');

  function updateFilter() {
    var minYear = parseInt(minYearSlider.value);
    var maxYear = parseInt(maxYearSlider.value);

    // Ensure minYear is not greater than maxYear
    if (minYear > maxYear) {
      minYearSlider.value = maxYear;
      minYear = maxYear;
    }

    minYearValue.textContent = minYear;
    maxYearValue.textContent = maxYear;

    // Update the fireLayer filter
    fireLayer.setWhere("FIRE_YEAR >= " + minYear + " AND FIRE_YEAR <= " + maxYear);
  }

  minYearSlider.addEventListener('input', updateFilter);
  maxYearSlider.addEventListener('input', updateFilter);
  </script>

</body>
</html>
